---
layout: post
published: true
title: 'Solidity 0.8.5 Release Announcement'
date: '2021-06-09'
author: Solidity Team
category: Releases
---

[Solidity v0.8.5](https://github.com/ethereum/solidity/releases/tag/v0.8.5) allows byte conversion, adds ``verbatim``builtin function to inject arbitrary bytecode in Yul and fixes several smaller bugs.


## Notable New Features
### Bytes Conversion

### ``Verbatim``in Yul

This release introduces the set of `verbatim` builtin functions for Yul that allows you inject
arbitrary bytecode into the binary. This is currently only available via pure Yul, i.e., it is not
accessible via inline assembly.

The functions are `verbatim<n>i_<m>o("<data>", ...)`, where
- `n` is a decimal between 0 and 99 that specifies the number of input stack slots / variables,
- `m` is a decimal between 0 and 99 that specifies the number of output stack slots / variables,
- `data` is a string literal that contains the sequence of bytes.

For example,

[EIP-3198](https://eips.ethereum.org/EIPS/eip-3198) proposes the the opcode `BASEFEE` at `0x48`.
Where BASEFEE is defined in [EIP-1559](https://eips.ethereum.org/EIPS/eip-3198). Since the Solidity
compiler currently does not support this opcode, one can use `verbatim` to implement this in Yul.

```Yul
{
	function basefee() -> out {
		out := verbatim_0i_1o(hex"48")
	}

	sstore(0, basefee())
}
```

Here's another example that 

```Yul
let x := calldataload(0)
// The hex"600202" corresponds to EVM instructions:
// PUSH 02 MUL
// That is, it multiplies x by 2.
let double := verbatim_1i_1o(hex"600202", x)
```

The above code will result in a `dup1` opcode to retrieve `x` (the optimizer may directly use the
result of the `calldataload` opcode, though) directly followed by `600202`. The code is assumed to
consume the (copied) value of `x` and produce the result on the top of the stack. The compiler then
generates code to allocate a stack slot for `double` and store the result there.

More details can be found in the
[documentation](https://docs.soliditylang.org/en/v0.8.5/yul.html#verbatim)


## Full Changelog

### Language Features:
 * Allowing conversion from ``bytes`` and ``bytes`` slices to ``bytes1``/.../``bytes32``.
 * Yul: Add ``verbatim`` builtin function to inject arbitrary bytecode.

### Compiler Features:
 * Code Generator: Insert helper functions for panic codes instead of inlining unconditionally. This can reduce costs if many panics (checks) are inserted, but can increase costs where few panics are used.
 * EVM: Set the default EVM version to "Berlin".
 * SMTChecker: Function definitions can be annotated with the custom Natspec tag ``custom:smtchecker abstract-function-nondet`` to be abstracted by a nondeterministic value when called.
 * Standard JSON / combined JSON: New artifact "functionDebugData" that contains bytecode offsets of entry points of functions and potentially more information in the future.
 * Yul Optimizer: Evaluate ``keccak256(a, c)``, when the value at memory location ``a`` is known at compile time and ``c`` is a constant ``<= 32``.

### Bugfixes:
 * AST: Do not output value of Yul literal if it is not a valid UTF-8 string.
 * Code Generator: Fix internal error when function arrays are assigned to storage variables and the function types can be implicitly converted but are not identical.
 * Code Generator: Fix internal error when super would have to skip an unimplemented function in the virtual resolution order.
 * Control Flow Graph: Assume unimplemented modifiers use a placeholder.
 * Control Flow Graph: Take internal calls to functions that always revert into account for reporting unused or unassigned variables.
 * Function Call Graph: Fix internal error connected with circular constant references.
 * Name Resolver: Do not issue shadowing warning if the shadowing name is not directly accessible.
 * Natspec: Allow multiple ``@return`` tags on public state variable documentation.
 * SMTChecker: Fix internal error on conversion from ``bytes`` to ``fixed bytes``.
 * SMTChecker: Fix internal error on external calls from the constructor.
 * SMTChecker: Fix internal error on struct constructor with fixed bytes member initialized with string literal.
 * Source Locations: Properly set source location of scoped blocks.
 * Standard JSON: Properly allow the ``inliner`` setting under ``settings.optimizer.details``.
 * Type Checker: Fix internal compiler error related to having mapping types in constructor parameter for abstract contracts.
 * Type Checker: Fix internal compiler error when attempting to use an invalid external function type on pre-byzantium EVMs.
 * Type Checker: Fix internal compiler error when overriding receive ether function with one having different parameters during inheritance.
 * Type Checker: Make errors about (nested) mapping type in event or error parameter into fatal type errors.

### AST Changes:
 * Add member `hexValue` for Yul string and hex literals.

A big thank you to all contributors who helped make this release possible!

Download the new version of Solidity [here](https://github.com/ethereum/solidity/releases/tag/v0.8.5).
